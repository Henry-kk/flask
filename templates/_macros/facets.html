{#  FACETS  #}

{% macro facet_languages(facet='languages', open='false') %}
<div class="panel panel-default facet-panel"
     ng-show="languages.length > 0">
    {{ facet_header( title   = 'All Languages',
    tooltip = 'languages',
    facet   = facet ) }}
    <div class="panel-body ng-cloak"
         ng-cloak
         ng-show='facets.{{facet}}.visible'>
        {{ render_languages() }}
    </div>
</div>
{% endmacro %}


{% macro facet_message_type(facet='message_types', open='false') %}
<div class="panel panel-default facet-panel">
    {{ facet_header( title   = 'All Message Types',
                     tooltip = 'message type',
                     facet   = facet ) }}
    <div class="panel-body ng-cloak"
         ng-cloak
         ng-show='facets.{{facet}}.visible'>
        {{ render_message_types() }}
    </div>
</div>
{% endmacro %}

{% macro facet_intentions(facet='intentions', open='false') %}
<div class="panel panel-default facet-panel">
    {{ facet_header( title   = 'All Intentions',
                     tooltip = 'intentions',
                     facet   = facet ) }}
    <div class="panel-body ng-cloak"
         ng-cloak
         ng-show='facets.{{facet}}.visible'>
        {{ render_intentions() }}
    </div>
</div>
{% endmacro %}

{% macro facet_agents(facet='agents') %}
<div class="panel panel-default facet-panel">

    {{ facet_header( title   = 'All Agents',
                     tooltip = 'agents',
                     facet   = facet ) }}

    <div ng-if="isAllAgentsDisabled">
        <div class="sidebar-header" style="position:relative">
            <h5 class="checkbox">
                <input type="checkbox"
                       class="ark-checkbox"
                       disabled="disabled" /><span></span>
                <span data-original-title="Not available in distribution view"
                   ui-jq="tooltip" class="icon-iw-active-circle-question"></span>All Agents</h5>
        </div>
    </div>
    <div class="panel-body ng-cloak"
         ng-cloak
         ng-show='facets.{{facet}}.visible'>
        {{ render_agents() }}
    </div>
</div>
{% endmacro %}

{% macro facet_topics(facet='topics') %}
<div class="panel panel-default facet-panel">
    {{ facet_header( title   = 'All Topics and Keywords',
                     tooltip = 'topics and keywords',
                     facet   = facet ) }}

    <div class="panel-body ng-cloak"
         ng-cloak
         ng-show='facets.{{facet}}.visible'>
        {{ render_topics() }}
    </div>
</div>
{% endmacro %}

{% macro facet_statuses(facet='statuses') %}
<div class="panel panel-default facet-panel">
    {{ facet_header( title   = 'All Posts Status',
                     tooltip = 'statuses',
                     facet   = facet ) }}

    <div class="panel-body ng-cloak"
         ng-cloak
         ng-show='facets.{{facet}}.visible'>
        {{ render_statuses() }}
    </div>
</div>
{% endmacro %}

{% macro facet_sentiments(facet='sentiments') %}
<div class="panel panel-default facet-panel">
    {{ facet_header( title   = 'All Sentiments',
                     tooltip = 'sentiments',
                     facet   = facet ) }}

    <div class="panel-body ng-cloak"
         ng-cloak
         ng-show='facets.{{facet}}.visible'>
        {{ render_sentiments() }}
    </div>
</div>
{% endmacro %}

{% macro facet_smart_tags(facet='smart_tags') %}
<div class="panel panel-default facet-panel">
    {{ facet_header( title   = 'All Smart Tags',
                     tooltip = 'Smart Tags',
                     facet   = facet ) }}

    <div class="panel-body ng-cloak"
         ng-cloak
         ng-show='facets.{{facet}}.visible'>
        {{ render_smart_tags() }}
    </div>
</div>
{% endmacro %}

{% macro facet_age_groups(facet='age_groups') %}
<div class="panel panel-default facet-panel">
    {{ facet_header( title   = 'All Age Groups',
                     tooltip = 'Age Groups',
                     facet   = facet ) }}

    <div class="panel-body ng-cloak"
         ng-cloak
         ng-show='facets.{{facet}}.visible'>
        {{ render_age_groups() }}
    </div>
</div>
{% endmacro %}

{% macro facet_customer_statuses(facet='customer_statuses') %}
<div class="panel panel-default facet-panel">
    {{ facet_header( title   = 'All Status',
                     tooltip = 'Status',
                     facet   = facet ) }}

    <div class="panel-body ng-cloak"
         ng-cloak
         ng-show='facets.{{facet}}.visible'>
        {{ render_customer_statuses() }}
    </div>
</div>
{% endmacro %}

{% macro facet_agent_occupancy(facet='agent_occupancy') %}
<div class="panel panel-default facet-panel">
    {{ facet_header( title   = 'All Agent Occupancy',
                     tooltip = 'Agent Occupancy',
                     facet   = facet ) }}

    <div class="panel-body ng-cloak"
         ng-cloak
         ng-show='facets.{{facet}}.visible'>
        {{ render_agent_occupancy() }}
    </div>
</div>
{% endmacro %}

{% macro facet_call_intents(facet='call_intents') %}
<div class="panel panel-default facet-panel">
    {{ facet_header( title   = 'All Call Intents',
                     tooltip = 'Call Intents',
                     facet   = facet ) }}

    <div class="panel-body ng-cloak"
         ng-cloak
         ng-show='facets.{{facet}}.visible'>
        {{ render_call_intents() }}
    </div>
</div>
{% endmacro %}

{% macro facet_segments(facet='segments') %}
<div class="panel panel-default facet-panel">
    {{ facet_header( title   = 'All Segments',
                     tooltip = 'Segments',
                     facet   = facet ) }}

    <div class="panel-body ng-cloak"
         ng-cloak
         ng-show='facets.{{facet}}.visible'>
        {{ render_segments() }}
    </div>
</div>
{% endmacro %}


{% macro facet_channels(facet='channels') %}
<div class="panel panel-default facet-panel">
    {{ facet_header( title   = 'All channels',
                     tooltip = 'Channels',
                     facet   = facet ) }}

    <div class="panel-body ng-cloak"
         ng-cloak
         ng-show='facets.{{facet}}.visible'>
        {{ render_channels() }}
    </div>
</div>
{% endmacro %}


{% macro facet_journey_statuses(facet='journey_statuses') %}
<div class="panel panel-default facet-panel">
    {{ facet_header( title   = 'All Journey Statuses',
    tooltip = 'All Journey Statuses',
    facet   = facet ) }}

    <div class="panel-body ng-cloak"
         ng-cloak
         ng-show='facets.{{facet}}.visible'>
        {{ render_journey_statuses() }}
    </div>
</div>
{% endmacro %}


{% macro facet_industries(facet='industries') %}
<div class="panel panel-default facet-panel">
    {{ facet_header( title   = 'All Industries',
                     tooltip = 'Industries',
                     facet   = facet ) }}

    <div class="panel-body ng-cloak"
         ng-cloak
         ng-show='facets.{{facet}}.visible'>
        {{ render_industries() }}
    </div>
</div>
{% endmacro %}


{% macro facet_journey_types(facet='journey_types') %}
<div class="panel panel-default facet-panel">
    {{ facet_header( title   = 'All Journey Types',
    tooltip = 'Journey Types',
    facet   = facet ) }}

    <div class="panel-body ng-cloak"
         ng-cloak
         ng-show='facets.{{facet}}.visible'>
        {{ render_journey_types() }}
    </div>
</div>
{% endmacro %}


{#  END OF FACETS #}



{% macro facet_header(title='', tooltip='', facet='', closed=True) %}
    <div class="panel-heading">

        <div class="panel-title row">
            <div class="col-sm-11 checkbox">
                <label class="checkbox">
                <input type="checkbox"
                       class="ark-checkbox"
                       ng-disabled="facets.{{facet}}.all"
                       ng-change="facets.{{facet}}.change()"
                       ng-model="facets.{{facet}}.all" />
                    <span></span>
                {{title}}
                </label>
                <span data-original-title="View data by all or a selection of {{tooltip}}"
                    ui-jq="tooltip"
                    class="icon-iw-active-circle-question"></span></div>
            {% if closed == True %}
            <div class="col-sm-1 panel-expander">
                <a ng-click = "toggleFacet( '{{facet}}' )">
                    <span ng-class="{false : 'icon-add', true : 'icon-minimize'}[facets.{{facet}}.visible]"></span>
                </a>
            </div>
            {% endif %}
        </div>
    </div>
{% endmacro %}

{% macro render_message_types() %}
	<ul>
        <li ng-repeat="message_type in message_types_filter">
            {% raw %}
            <label class="checkbox">
                <input type="checkbox"
                       class="ark-checkbox"
                       ng-disabled="is_facet_disabled"
                       ng-model="message_type.enabled"
                       ng-change="updateMessageTypes()"
                       ng-value="message_type.label" /><span></span>
                <span ng-bind="message_type.display">Loading...</span>
            </label>
            {% endraw %}
        </li>
    </ul>
{% endmacro%}

{% macro render_languages() %}
	<ul>
        <li ng-repeat="language in languages">
            {% raw %}
            <label class="checkbox">
                <input type="checkbox"
                       class="ark-checkbox"
                       ng-disabled="is_facet_disabled"
                       ng-model="language.enabled"
                       ng-change="updateLanguages()"
                       ng-value="language.code" /><span></span>
                <span ng-bind="language.title">Loading...</span>
            </label>
            {% endraw %}
        </li>
    </ul>
{% endmacro%}

{% macro render_intentions() %}
    <ul>
        <li ng-repeat="intention in intentions_filter">
            {% raw %}
            <label class="checkbox">
                <input type="checkbox"
                       ng-disabled="is_facet_disabled"
                       ng-model="intention.enabled"
                       ng-change="updateIntentions()"
                       ng-value="intention.label"
                       class="ark-checkbox" /><span></span>
                <span ng-bind="intention.display"
                      class="label intention-item"
                      ng-init="labelColor={backgroundColor:intention.color}"
                      ng-style="labelColor">Loading...</span>
            </label>
            {% endraw %}
        </li>
    </ul>
{% endmacro%}

{% macro render_agents() %}
   <ul>
        <li ng-repeat="agent in agents">
            <label class="checkbox" ng-show="agent.can_view == true">
                <input type="checkbox"
                       ng-disabled="is_facet_disabled"
                       ng-model="agent.enabled"
                       ng-value="agent.agent_id"
                       class="ark-checkbox" /><span></span>
                <span ng-bind="agent.display_name">Loading...</span>
            </label>
        </li>
    </ul>
{% endmacro %}

{%- macro render_topics() -%}
    <div>
    <div ng-show="topics.length > 0" style="padding-top:5px; min-height: 50px">
        <input type="text"
               class="input-block-level form-control"
               placeholder="Filter results"
               ng-model="search"
               ng-show="isPunk == false" />
        <div class="pull-right">
            <button class="btn btn-sm btn-warning"
                    ng-show="isPunk == true"
                    ng-click="backToHotTopics()">Back</button>
        </div>
    </div>
    <div style="width: 100%">
        <table  ng-show="topics.length > 0"
                ng-cloak
                class="table
                       table-striped
                       table-condensed
                       ng-cloak">
            {% raw %}
            <tbody>
            <tr ng-repeat="item in topics | filter:search">
                <td style="padding-left: 20px">
                    <label class="checkbox">
                        <input type="checkbox"
                               class="ark-checkbox"
                               ng-disabled="is_facet_disabled"
                               ng-model="item.enabled"
                               ng-click="toggle(item)"><span></span>
                        <span ng-click="getPunks(item)"
                              ng-bind="item.topic  | truncate:15"
                              ng-class="{node_term: (item.term_count != item.topic_count) }"></span>
                    </label>
                </td>
                <td class="text-right" ng-bind="item.term_count">Loading...</td>
            </tr>
            </tbody>
            {% endraw %}
        </table>
        <div class="alert alert-info"
             ng-show="topics.length == 0">
            <i class="icon-exclamation-sign"></i>
            No results available
        </div>
    </div>
</div>
{% endmacro %}

{%- macro render_statuses() -%}
    <ul>
    <li ng-repeat="status in statuses_filter">
        <label class="checkbox">
            {% raw %}
            <input type="checkbox"
                   ng-disabled="is_facet_disabled"
                   ng-model="status.enabled"
                   ng-change="updatePostStatuses()"
                   ng-value="status.label"
                   class="ark-checkbox" /><span></span>
            <span ng-bind="status.display">Loading...</span>
            {% endraw %}
        </label>
    </li>
</ul>
{% endmacro %}

{%- macro render_sentiments() -%}
    <ul>
    <li ng-repeat="sentiment in sentiments_filter">
        <label class="checkbox">
            {% raw %}
            <input type="checkbox"
                   class="ark-checkbox"
                   ng-disabled="is_facet_disabled"
                   ng-model="sentiment.enabled"
                   ng-change="updateSentiments()"
                   ng-value="sentiment.label" /><span></span>
            <span ng-bind="sentiment.label"
                  class="label"
                  ng-init="labelColor={color:sentiment.color}"
                  ng-style="labelColor">Loading...</span>
            {% endraw %}
        </label>
    </li>
</ul>
{% endmacro %}


{% macro render_smart_tags() %}
<ul style="max-height: 120px; overflow-y:auto;">
        <li ng-repeat="t in smart_tags" class="clearfix">

                <label class="checkbox pull-left">
                    <input type="checkbox"
                           class="ark-checkbox"
                           ng-disabled="is_facet_disabled"
                           ng-model="t.selected"
                           ng-value="t" /><span></span>
                    <span ng-bind="t.title"></span>
                </label>

            <div class="pull-right"
                 style="vertical-align: bottom;"><slr-smart-tags-modal smart-tag="t"></slr-smart-tags-modal></div>
        </li>
</ul>
{% endmacro %}


{%- macro render_age_groups() -%}
<ul>
    <li ng-repeat="filter in age_groups_filter">
        {% raw %}
        <label class="checkbox">
            <input type="checkbox"
                   class="ark-checkbox"
                   ng-disabled="is_facet_disabled"
                   ng-model="filter.enabled"
                   ng-change="Filter.updateAgeGroups()"><span></span>
            <span ng-bind="filter.display">Loading...</span>
        </label>
        {% endraw %}
    </li>
</ul>
{% endmacro %}


{%- macro render_customer_statuses() -%}
<ul>
    <li ng-repeat="filter in customer_statuses_filter">
        {% raw %}
        <label class="checkbox">
            <input type="checkbox"
                   ng-disabled="is_facet_disabled"
                   ng-model="filter.enabled"
                   ng-change="Filter.updateCustomerStatuses()"
                   class="ark-checkbox"><span></span>
            <span ng-bind="filter.display">Loading...</span>
        </label>
        {% endraw %}
    </li>
</ul>
{% endmacro %}


{%- macro render_agent_occupancy() -%}
<ul>
    <li ng-repeat="filter in agent_occupancy_filter">
        {% raw %}
        <label class="checkbox">
            <input type="checkbox"
                   class="ark-checkbox"
                   ng-disabled="is_facet_disabled"
                   ng-model="filter.enabled"
                   ng-change="Filter.updateAgentOccupancy()" /><span></span>
            <span ng-bind="filter.display">Loading...</span>
        </label>
        {% endraw %}
    </li>
</ul>
{% endmacro %}


{%- macro render_call_intents() -%}
<ul>
    <li ng-repeat="t in facets.call_intents.list">
        {% raw %}
        <label class="checkbox">
            <input type="checkbox"
                   class="ark-checkbox"
                   ng-disabled="is_facet_disabled"
                   ng-model="t.enabled"
                   ng-change="updateCallIntents()" /><span></span>
            <span ng-bind="t.display_name">Loading...</span>
        </label>
        {% endraw %}
    </li>
</ul>
{% endmacro %}


{%- macro render_segments() -%}
<ul>
    <li ng-repeat="t in facets.segments.list">
        <label class="checkbox">
            <input type="checkbox"
                   class="ark-checkbox"
                   ng-disabled="is_facet_disabled"
                   ng-model="t.enabled"
                   ng-change="updateSegments()" /><span></span>
            <span ng-bind="t.display_name">Loading...</span>
        </label>
    </li>
</ul>
{% endmacro %}


{%- macro render_journey_statuses() -%}
<ul>
    <li ng-repeat="t in facets.journey_statuses.list">
        <label class="checkbox">
            <input type="checkbox"
                   class="ark-checkbox"
                   ng-disabled="is_facet_disabled"
                   ng-model="t.enabled"
                   ng-change="updateJourneyStatuses()" /><span></span>
            <span ng-bind="t.display_name">Loading...</span>
        </label>
    </li>
</ul>
{% endmacro %}


{%- macro render_industries() -%}
<ul>
    <li ng-repeat="t in facets.industries.list">
        {% raw %}
        <label class="checkbox">
            <input type="checkbox"
                   class="ark-checkbox"
                   ng-disabled="is_facet_disabled"
                   ng-model="t.enabled"
                   ng-change="updateIndustries()" /><span></span>
            <span ng-bind="t.display_name">Loading...</span>
        </label>
        {% endraw %}
    </li>
</ul>
{% endmacro %}



{%- macro render_channels() -%}
<ul>
    <li ng-repeat="t in facets.channels.list">
        <label class="checkbox">
            <input type="checkbox"
                   class="ark-checkbox"
                   ng-disabled="is_facet_disabled"
                   ng-model="t.enabled"
                   ng-change="updateChannels()" /><span></span>
            <span ng-bind="t.display_name">Loading...</span>
        </label>
    </li>
</ul>
{% endmacro %}


{%- macro render_journey_types() -%}
<ul>
    <li ng-repeat="t in facets.journey_types.list">
        {% raw %}
        <label class="radio">
            <input type="radio"
                   class="ark-radiobtn"
                   ng-value="t.id"
                   name="{{t.display_name}}"
                   ng-disabled="is_facet_disabled"
                   ng-model="facets.journey_types.selected"
                   ng-change="updateJourneyTypes(t.id)" /><span></span>
            <span ng-bind="t.display_name">Loading...</span>
        </label>
        {% endraw %}
    </li>
</ul>
{% endmacro %}

{% macro selected_facet( facetTitle='', facetList=None, removeMethod='', displayField=None, removeField=None) %}
    {% if facetList is string %}
    <ul class="select2-choices"
        ng-show="{{facetList}}.length > 0"
        style="float:left;
               margin-right:5px;
               border:none;
               background: transparent none;
               box-shadow:none;
               -webkit-box-shadow: none">
        <li style="padding-top:3px"><span style="font-weight:bold">{{facetTitle}}:</span></li>
        <li ng-repeat="item in {{facetList}}"
            class="select2-search-choice"
            style="line-height: 11px">
            <div style="font-size: 11px" ng-bind="item{% if displayField is string %}{{displayField}}{% endif %}"></div>
            <a href=""
               ng-click="{{removeMethod}}(item{% if removeField is string %}{{removeField}}{% endif %})"
               class="select2-search-choice-close"
               tabindex="-1"></a>
        </li>
    </ul>
    {% endif %}
{% endmacro %}


{% macro render_facet_tags() %}
<div class="row" ng-show="myTopics.length   > 0 ||
          selectedStatuses.length   > 0 ||
          selectedLanguages.length  > 0 ||
          selectedSentiments.length > 0 ||
          selectedIntentions.length > 0 ||
          selected_smart_tags.length > 0 ||
          selectedAgents.length     > 0 ||
          selectedAgeGroups.length > 0 ||
          selectedCustomerStatuses.length > 0 ||
          selectedAgentOccupancy.length > 0 ||
          selectedCallIntents.length > 0 ||
          selectedSegments.length > 0 ||
          selectedIndustries.length > 0"

        style="border-top:1px solid #ddd;
                border-bottom:1px solid #ddd;
                clear:both;
                padding-bottom:3px;
                margin-top:-5px;
                margin-bottom:5px">
    <div class="col-sm-12">
        <div style="background-color:#fff;">
            <div class="select2-container-multi ng-cloak clearfix"
                 ng-cloak
                 style="padding: 3px 55px 3px 0;
                        position: relative;
                        margin: 0;
                        width: 100%
                        box-sizing: border-box;">

                {{ selected_facet(facetTitle='Languages',  facetList='selectedLanguages',  removeMethod='removeLanguage') }}
                {{ selected_facet(facetTitle='Intentions', facetList='selectedIntentions', removeMethod='removeIntention') }}
                {{ selected_facet(facetTitle='Sentiments', facetList='selectedSentiments', removeMethod='removeSentiment') }}
                {{ selected_facet(facetTitle='Agents',     facetList='selectedAgents',     removeMethod='removeAgent',
                                                                                           displayField='.display_name',
                                                                                           removeField='.agent_id')        }}
                {{ selected_facet(facetTitle='Topics', facetList='myTopics',           removeMethod='remove',
                                                                                           displayField='.topic')          }}

                {{ selected_facet(facetTitle='Status',     facetList='selectedStatuses',   removeMethod='removeStatus',
                                                                                           displayField='.display')        }}

                {{ selected_facet(facetTitle='Smart Tags', facetList='selected_smart_tags', removeMethod='removeSmartTag',
                                                                                            displayField='.title')        }}

                {{ selected_facet(facetTitle='Age Groups', facetList='selectedAgeGroups', removeMethod='Filter.removeAgeGroup') }}

                {{ selected_facet(facetTitle='Status', facetList='selectedCustomerStatuses', removeMethod='Filter.removeCustomerStatus') }}

                {{ selected_facet(facetTitle='Agent Occupancy', facetList='selectedAgentOccupancy', removeMethod='Filter.removeAgentOccupancy') }}

                {{ selected_facet(facetTitle='Call Intent', facetList='selectedCallIntents', removeMethod='removeCallIntent') }}

                {{ selected_facet(facetTitle='Segments', facetList='selectedSegments', removeMethod='removeSegment') }}

                {{ selected_facet(facetTitle='Industries', facetList='selectedIndustries', removeMethod='removeIndustry') }}

                <button class="btn btn-sm btn-default"
                        ng-click="resetAll()"
                        style="position: absolute; top: 5px; right: 0">Reset All</button>
            </div>
        </div>
    </div>

</div>
{% endmacro %}

